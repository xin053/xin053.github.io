---
title: UTF-8编码
date: 2016-09-07 16:26:10
categories: 
- WeNeedToKnow
tags:
- UTF-8
- utf8
---

## 简介
UTF8编码使用1到4个字节来表示每个Unicode码点， ASCII部分字符只使用1个字节， 常用字符部分使用2或3个字节表示。 每个符号编码后第一个字节的高端bit位用于表示总共有多少编码个字节。 如果第一个字节的高端bit为0， 则表示对应7bit的ASCII字符， ASCII字符每个字符依然是一个字节， 和传统的ASCII编码兼容。 如果第一个字节的高端bit是110， 则说明需要2个字节；后续的每个高端bit都以10开头。 

```
0xxxxxxx 								runes 0-127 (ASCII)
110xxxxx 10xxxxxx 						128-2047 (values <128 unused)
1110xxxx 10xxxxxx 10xxxxxx 				2048-65535 (values <2048 unused)
11110xxx 10xxxxxx 10xxxxxx 10xxxxxx 	65536-0x10ffff (other values unused)
```

变长的编码无法直接通过索引来访问第n个字符， 但是UTF8编码获得了很多额外的优点。 首先UTF8编码比较紧凑， 完全兼容ASCII码， 并且可以自动同步：它可以通过向前回朔最多2个字节就能确定当前字符编码的开始字节的位置。 它也是一个前缀编码， 所以当从左向右解码时不会有任何歧义也并不需要向前查看

**没有任何字符的编码是其它字符编码的子串， 或是其它编码序列的字串， 因此搜索一个字符时只要搜索它的字节编码序列即可， 不用担心前后的上下文会对搜索结果产生干扰。 同时UTF8编码的顺序和Unicode码点的顺序一致， 因此可以直接排序UTF8编码序列。 同时因为没有嵌入的NUL(0)字节， 可以很好地兼容那些使用NUL作为字符串结尾的编程语言。**

<!-- more -->

Unicode转义字符让我们可以通过Unicode码点输入特殊的字符。 有两种形式：`\uhhhh`对应16bit的码点值， `\Uhhhhhhhh`对应32bit的码点值， 其中h是一个十六进制数字；一般很少需要使用32bit的形式。 每一个对应码点的UTF8编码。 例如：下面的字母串面值都表示相同的值：

```
"世界"
"\xe4\xb8\x96\xe7\x95\x8c"
"\u4e16\u754c"
"\U00004e16\U0000754c"
```

上面三个转义序列都为第一个字符串提供替代写法， 但是它们的值都是相同的。

Unicode转义也可以使用在rune字符中。 下面三个字符是等价的：

```
'世' '\u4e16' '\U00004e16'
```

对于小于256码点值可以写在一个十六进制转义字节中， 例如`\x41`对应字符`A`， 但是对于更大的码点则必须使用`\u`或`\U`转义形式。 因此， `\xe4\xb8\x96`并不是一个合法的rune字符， 虽然这三个字节对应一个有效的UTF8编码的码点。

得益于UTF8编码优良的设计， 诸多字符串操作都不需要解码操作。 我们可以不用解码直接测试一个字符串是否是另一个字符串的前缀,或者是后缀测试,或者是包含子串测试.